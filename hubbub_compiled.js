var hubbub={};hubbub.FeedItem=Backbone.Model.extend({updateTags:function(a){this.set({tags:a})}});hubbub.FeedItemCollection=Backbone.Collection.extend({model:hubbub.FeedItem});hubbub.TagItem=Backbone.Model.extend({urlRoot:"../tag-items"});hubbub.TagItemCollection=Backbone.Collection.extend({model:hubbub.TagItem});hubbub.Service=Backbone.Model.extend({initialize:function(a){this.name=a.name;this.selected=a.selected||!1},select:function(){this.set("selected",!0)},unselect:function(){this.set("selected",!1)}});hubbub.ServiceCollection=Backbone.Collection.extend({model:hubbub.Service});hubbub.stubFeedItems=function(){return new hubbub.FeedItemCollection([new hubbub.FeedItem({source:"Imgur",url:"http://i.imgur.com/nvnXc.png"}),new hubbub.FeedItem({source:"Gmail",from:"Michael Jordan",subject:"Hey Dude",body:"<p>You are an even better player of basketball than me.</p><p>We ought to play sometime.</p><p>Here, just call me next time you&#39;re at the space station. 999-DUDE</p><p>-The Jord</p>",tags:["Important","Fun"]}),new hubbub.FeedItem({source:"Twitter",username:"alltom",body:"I wish I a Google+ account!",
tags:["codeStuff"]}),new hubbub.FeedItem({source:"Facebook",username:"Ben Bitdiddle",body:"I now have exactly 3333 friends!"}),new hubbub.FeedItem({source:"Imgur",url:"http://theawesomer.com/photos/2011/04/041911_nyan_pop_tart_cat_t.jpg"}),new hubbub.FeedItem({source:"Twitter",username:"leibatt",body:"zomg is this thing on?"}),new hubbub.FeedItem({source:"Gmail",from:"Bill Gates",subject:"Hello",body:"<p>I see you're follwing me on twitter. I'm honored!</p><p>Look me up if you're ever in Bellevue. We'll hang out at my pad. It's pretty sweet.</p><p>-Bill.com</p>",
tags:["Fun"]}),new hubbub.FeedItem({source:"Imgur",url:"http://icanhascheezburger.files.wordpress.com/2008/01/funny-pictures-lolspeak-jaws-shark.jpg"}),new hubbub.FeedItem({source:"Facebook",username:"Mark Zuckerberg",body:"The venture Rahul proposed is great! We will be implementing it shortly!"}),new hubbub.FeedItem({source:"Gmail",from:"Your Mom",subject:"Your Mom",body:'<p>I heard she is so fat...</p><p>Her joke can\'t fit in the preview.</p><a href="http://www.yomamma.com">www.yomamma.com</a><p>-Anonymous</p>',
source:"Gmail",tags:["Fun"]}),new hubbub.FeedItem({source:"Twitter",username:"NYTimesVisual",body:'Minorca Revealed <a href="http://nyti.ms/IocqqU">http://nyti.ms/IocqqU</a>',tags:["Fun"]}),new hubbub.FeedItem({source:"Imgur",url:"http://i.imgur.com/hWZCz.jpg"}),new hubbub.FeedItem({source:"Twitter",username:"NYTimesVisual",body:'In Nigeria, a Preview of an Overcrowded Planet <a href="http://nyti.ms/HHfuSU">http://nyti.ms/HHfuSU</a>',tags:["Important"]}),new hubbub.FeedItem({source:"Gmail",from:"Katrina Panovich",
subject:"RE: GR4 Extensions for Everyone!",body:"<p>:O</p><p>On Sun, Apr 15, 2012 at 11:58 PM, Rob Miller &lt;rcm@mit.edu&gt; wrote:<br/>>All you have to do is ask Katrina. No gotchas, except that all team members have to email Katrina separately.<br/>><br/>>-Rob</p>",tags:["codeStuff"]}),new hubbub.FeedItem({source:"Imgur",url:"http://i.imgur.com/KFxnf.jpg"}),new hubbub.FeedItem({source:"Twitter",username:"NYTimesVisual",body:'FASHION: Bill Cunningham | All the Frills <a href="http://nyti.ms/HHfuT0">http://nyti.ms/HHfuT0</a>'}),
new hubbub.FeedItem({source:"Twitter",username:"NYTimesVisual",body:'Study Abroad, Mormon Style <a href="http://nyti.ms/HxUlGY">http://nyti.ms/HxUlGY</a>',tags:["codeStuff"]}),new hubbub.FeedItem({source:"Gmail",from:"Rob Miller",subject:"GR4 Extensions for Everyone!",body:"<p>All you have to do is ask Katrina. No gotchas, except that all team members have to email Katrina separately.<br/><br/>-Rob</p>",tags:["codeStuff"]}),new hubbub.FeedItem({source:"Twitter",username:"BillGates",body:'How do #naturalgas prices affect energy innovation? Part 1 of my chat w Daniel Yergin. Video: <a href="http://b-gat.es/IM5wj5">http://b-gat.es/IM5wj5</a>',
tags:["Fun"]}),new hubbub.FeedItem({source:"Twitter",username:"BillGates",body:'Great interest in my recent trip to Africa. We learned a lot, came back energized. Gallery from the trip: <a href="http://b-gat.es/IvdwDz">http://b-gat.es/IvdwDz</a>',tags:["Fun"]}),new hubbub.FeedItem({source:"Gmail",from:"Rahul Rajagopalan",subject:"RE: GR4",body:"<p>I heard that too.<br/><br/>-Rahul</p><p>On Sun, April 15, 2012 at 10:13pm, Leilani Battle &lt;leibatt@mit.edu&gt; wrote:<br/>&gt;Hey,<br/>&gt;Heard through the grape vine that we can get extensions if we email Katrina! XD<br/>><br/>>--Leilani</p>"}),
new hubbub.FeedItem({source:"Gmail",from:"Leilani Battle",subject:"GR4",body:"<p>Hey,<br/>Heard through the grape vine that we can get extensions if we email Katrina! XD<br/><br/>--Leilani</p>"}),new hubbub.FeedItem({source:"Imgur",url:"http://i.imgur.com/cCb6y.jpg"})])};hubbub.stubTagItems=function(){return new hubbub.TagItemCollection([new hubbub.TagItem({tagname:"Important"}),new hubbub.TagItem({tagname:"Fun"}),new hubbub.TagItem({tagname:"codeStuff"}),new hubbub.TagItem({tagname:"sillyPics"})])};
hubbub.stubServices=function(){return new hubbub.ServiceCollection([new hubbub.Service({name:"Twitter"}),new hubbub.Service({name:"Facebook"}),new hubbub.Service({name:"Imgur"}),new hubbub.Service({name:"Gmail"})])};hubbub.changeButtonText=function(a,b){b.parent().find(".ui-btn-text").text(a)};hubbub.FeedPageView=Backbone.View.extend({initialize:function(a){this.feedItemTemplates=a.feedItemTemplates;this.template=_.template(a.pageTemplate.html())},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.listView=new hubbub.FeedListView({el:$("#feedList",this.el),model:this.model,feedItemTemplates:this.feedItemTemplates});this.listView.render();return this}});
hubbub.FeedListView=Backbone.View.extend({initialize:function(a){this.feedItemTemplates=a.feedItemTemplates;this.model.bind("reset",this.render,this)},render:function(){$(this.el).empty();this.model.each(function(a){a=(new hubbub.FeedItemView({model:a,feedItemTemplate:this.feedItemTemplates[a.get("source")]||this.feedItemTemplates.generic,collectionRef:this.model})).render().el;$(this.el).append(a)},this);$("#feedList").listview("refresh");return this}});
hubbub.FeedItemView=Backbone.View.extend({events:{"click input":"onButtonClick"},className:"feedItem",collapseHeight:115,initialize:function(a){this.template=_.template(a.feedItemTemplate.html());this.collectionRef=a.collectionRef},render:function(){$(this.el).addClass(this.model.get("source").toLowerCase());$(this.el).html(this.template(_.defaults(this.model.toJSON(),{body:"Template Missing"})));$(".hubbub-feeditem-tag-button",this.el).attr("href","#tag/"+this.collectionRef.indexOf(this.model));
this.addTagView();setTimeout(this.checkShouldCollapse.bind(this),10);return this},addTagView:function(){if(this.model.has("tags"))for(var a=this.model.get("tags"),b=0;b<a.length;b++){var c=$('<span class="feed-tag-set-item"></span>').appendTo($(".feedTagSet",this.el));c.html(a[b]);b===a.length-1&&c.addClass("last")}},onButtonClick:function(a){a=$(a.currentTarget);if("Save"===a.attr("value"))this.onSaveButtonClick(a);else if("Share"===a.attr("value"))this.onShareButtonClick(a)},onSaveButtonClick:_.bind(hubbub.changeButtonText,
null,"Saved!"),onShareButtonClick:_.bind(hubbub.changeButtonText,null,"Shared!"),checkShouldCollapse:function(){var a=$(this.el).outerHeight()>this.collapseHeight;"Imgur"==this.model.get("source")&&(a=!0);a&&this.makeCollapsible()},makeCollapsible:function(){$(this.el).css("max-height",this.collapseHeight);this.collapsed=!0;this.expandButton=$('<a class="feeditem-expand-button"></a>').css({position:"absolute",height:20,bottom:0,width:"100%"}).appendTo($(this.el));$(".feeditem-expand-button",this.el).button();
this.expandButton.html("Expand");this.expandButton.click(_.bind(function(){this.collapsed?this.expand():this.collapse()},this))},expand:function(){$(this.el).css({"max-height":"none"});var a=$(this.el).outerHeight();$(this.el).css({height:this.collapseHeight});$(this.el).animate({height:a+this.expandButton.innerHeight()});this.expandButton.html("Shrink");this.collapsed=!1},collapse:function(){$(this.el).animate({height:this.collapseHeight},{complete:_.bind(function(){$(this.el).css({height:"auto",
"max-height":this.collapseHeight})},this)});this.expandButton.html("Expand");this.collapsed=!0}});hubbub.TagView=Backbone.View.extend({events:{"click .hubbub-tag-ok-button":"updateTags"},initialize:function(a){this.template=_.template(a.tagTemplate.html())},render:function(){$(this.el).html(this.template());if(this.model.has("tags"))for(var a=this.model.get("tags"),b=0;b<a.length;b++){var c=a[b];$(".hubbub-user-defined-tag",this.el).filter(function(){return $(this).attr("name")===c}).prop("checked",!0)}return this},updateTags:function(){var a=[];$(".hubbub-user-defined-tag",this.el).each(function(){$(this).attr("checked")&&
a.push($(this).attr("name"))});this.model.set("tags",a)}});hubbub.FilterView=Backbone.View.extend({selectedServiceClass:"selectedService",events:{"click .serviceLogo":"onServiceLogoClick"},initialize:function(a){this.template=_.template(a.filterTemplate.html());this.tagItemTemplate=a.tagItemTemplate;this.tagItems=a.tagItems;this.services=a.services},render:function(){$(this.el).html(this.template());this.listView=new hubbub.TagListView({el:$("#tagList",this.el),model:this.tagItems,tagItemTemplate:this.tagItemTemplate});this.listView.render();return this},
onServiceLogoClick:function(a){var a=$(a.currentTarget),b=a.find("img").attr("data-name"),c=this.services.where({name:b});if(1!==c.length)throw Error("There should only be one service with name "+b+", but there were "+d.length);var d=c[0];d.get("selected")?(d.unselect(),a.removeClass(this.selectedServiceClass)):(d.select(),a.addClass(this.selectedServiceClass))}});hubbub.TagPageView=Backbone.View.extend({events:{"click #hubbub-tag-ok-button":"updateTags","click #hubbub-new-tag-submit":"addTag"},initialize:function(a){this.tagItemTemplate=a.tagItemTemplate;this.template=_.template(a.pageTemplate.html());this.feedItem=a.feedItem;this.feedItemIndex=a.feedItemIndex},render:function(){$(this.el).html(this.template());this.listView=new hubbub.TagListView({el:$("#tagList",this.el),model:this.model,tagItemTemplate:this.tagItemTemplate,feedItem:this.feedItem});this.listView.render();
return this},updateTags:function(){var a=[];$(".hubbub-user-defined-tag",this.el).each(function(){$(this).attr("checked")&&a.push($(this).attr("name"))});this.feedItem.set("tags",a)},addTag:function(){var a=$("input#hubbub-new-tag-text").val();if(""!==a)if(0==this.model.filter(function(b){return b.get("tagname")===a}).length){var b=new hubbub.TagItem({tagname:a});this.model.add(b);this.listView.addTag(b);$("input#hubbub-new-tag-text").val("")}else alert('Tag name "'+a+'" already exists.');return!1}});
hubbub.TagListView=Backbone.View.extend({initialize:function(a){this.tagItemTemplate=a.tagItemTemplate;this.model.bind("reset",this.render,this);this.feedItem=a.feedItem},renderNoFeedItem:function(){$(this.el).empty();this.model.each(function(a){a=(new hubbub.TagItemView({model:a,tagItemTemplate:this.tagItemTemplate})).render().el;$(this.el).append(a)},this);$("#tagList").listview("refresh");return this},render:function(){if(!this.feedItem)return this.renderNoFeedItem();var a=[];this.feedItem.has("tags")&&
(a=this.feedItem.get("tags"));$(this.el).empty();this.model.each(function(b){for(var b=(new hubbub.TagItemView({model:b,tagItemTemplate:this.tagItemTemplate})).render().el,c=0;c<a.length;c++)$(".hubbub-user-defined-tag",b).filter(function(){return $(this).attr("name")===a[c]}).prop("checked",!0);$(this.el).append(b)},this);$("#tagList").listview("refresh");return this},addTag:function(a){a=(new hubbub.TagItemView({model:a,tagItemTemplate:this.tagItemTemplate})).render().el;$(this.el).append(a).trigger("create")}});
hubbub.TagItemView=Backbone.View.extend({tagName:"div",className:"tagItem",initialize:function(a){this.template=_.template(a.tagItemTemplate.html())},render:function(){$(this.el).html(this.template(this.model.toJSON()));$(".hubbub-user-defined-tag",this.el).attr("name",this.model.get("tagname"));return this}});hubbub.Router=Backbone.Router.extend({routes:{"":"listFeedItems","feed-items":"listFeedItems",filter:"filter","tag/:feedItemIndex":"listTagItems"},initialize:function(){this.feedItems=hubbub.stubFeedItems();this.tagItems=hubbub.stubTagItems();this.firstPage=!0;this.feedPageTemplate=$("#feedPageTemplate");this.feedItemTemplate=$("#genericFeedItemTemplate");this.gmailItemTemplate=$("#gmailItemTemplate");this.twitterItemTemplate=$("#twitterItemTemplate");this.imgurItemTemplate=$("#imgurItemTemplate");
this.facebookItemTemplate=$("#facebookItemTemplate");this.filterTemplate=$("#filterTemplate");this.tagPageTemplate=$("#tagPageTemplate");this.tagItemTemplate=$("#tagItemTemplate")},listFeedItems:function(){this.changePage(new hubbub.FeedPageView({model:this.feedItems,pageTemplate:this.feedPageTemplate,feedItemTemplates:{Gmail:this.gmailItemTemplate,Twitter:this.twitterItemTemplate,Imgur:this.imgurItemTemplate,Facebook:this.facebookItemTemplate,generic:this.feedItemTemplate}}))},filter:function(){this.changePage(new hubbub.FilterView({filterTemplate:this.filterTemplate,
tagItems:this.tagItems,tagItemTemplate:this.tagItemTemplate,services:hubbub.stubServices()}))},listTagItems:function(a){this.changePage(new hubbub.TagPageView({model:this.tagItems,pageTemplate:this.tagPageTemplate,tagItemTemplate:this.tagItemTemplate,feedItem:this.feedItems.at(a),feedItemIndex:a}))},changePage:function(a){$(a.el).attr("data-role","page");a.render();$("body").append($(a.el));var b=$.mobile.defaultPageTransition;this.firstPage&&(b="none",this.firstPage=!1);$.mobile.changePage($(a.el),
{changeHash:!1,transition:b})}});$(function(){new hubbub.Router;Backbone.history.start()});
